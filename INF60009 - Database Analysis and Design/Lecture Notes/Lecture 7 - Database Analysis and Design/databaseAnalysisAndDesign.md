## Lecture 7 - Database, Analysis and Design

### Entity Names and Meanings

In an ERD, clear entity names that describe exactly what something is allows to avoid confusing situations where you don't know what its purpose is.

For example, the words **class**, **tutorial** and **lab** can all mean the same thing and are generally used interchangably depending on the person. 

Furthermore, these words can also mean different things within different systems. It is better to obtain a clear understanding of the exact meaning of an entity before the system is designed.

### Student Enrollment System

In previous weeks we have broken down the student enrollment system into the following diagram.

**Insert Image**

In an actual univerity, this solution has certain limitations as we are also required to record when a student has done a subject and whether they have passed.

If we add the **Year** and **Semester** information to the SUBJECT entity, we end up creating redundant data since each time a student repeats a subject, we include all the information about the subject including the description and title along with it.

### Static and Variable Data (Attributes)

The concept of static data is data that is constant in that it is not expected to change at all. With this, we can detail things such as **Subject Code**, **Subject Title**, and **Subject Description** as attributes that do not change from semester to semester.

Conversely, variable data is data that is expected to change.

For the student enrollment system, we can create another entity called **Subject Offering** that will hold the variable data. This entity has a **Many to One** relationship with the **Subject**.

If we split the static and variable data into seperate entities we will have the following result.

**Insert Image**

Furthermore, it means that the **Student** entity will have a relationship with the variable data **Subject Offering** to successfully enroll into a **Subject**.

**Insert Image**

### Building an ERD

The idea behind drawing an ERD is to start off small then iterate through the design. It is good to follow these steps -

- **Draw M:M Relationships**

Rather than expanding the M:M relationships out, it is better to start small and simply create and stick with them in the beginning. Furthermore, writing the relationship between the entities makes more sense and is more definitive.

i.e. "An Actor appears in Many Movies. A Movie has Many Actors".

### Updated Enrollment System

**Insert Image**

Depending on which one you feel comfortable with, expanding the relationships in the begining can make the diagram feel cluttered.

### Testing the ERD

Once the ERD is completed, run it through some test scenarios -

- **Does it match the business rules**

- **Can it be navigated**

- **Does test data work**

### Views

A view is a way to store a complex SQL select query and give it a name. It allows you to define the query and then access it repetitively much like you would write a function in a programming language.

For example -

```
SELECT e.empno, e.empname, e.deptid, b.bname
FROM EMPLOYEE e
INNER JOIN BRANCH b
ON e.bno = b.bno;
```

If you gave the above query the name **EmpView*, you can later refer to it through the following shorter command.

```
SELECT *
FROM EMPVIEW;
```

The view will only store the query but not the data. It is sometimes called a **virtual table** but is not a **table**. The data in the result set from the view is not saved, and will instead run the SQL query each time it is called.

A view also behaves like a table, where you can run queries on the result set generated by the view.

```
SELECT * FROM EMPVIEW;

SELECT epmname, bname
FROM EMPVIEW
WHERE empno = 15;

OR

SELECT e.empname, d.deptname
FROM EMPVIEW e
INNER JOIN DEPARTMENT d
ON e.deptid = d.deptid
```

The great thing about using views is that it allows you create complex queries that can be run with only one line.

### Creating Views

To create a view, we can do something like the following

```
CREATE VIEW EMPAVG AS
	SELECT d.deptname, Avg(e.salary) "Average Salary"
	FROM EMPLOYEE e,
	INNER JOIN DEPARTMENT d
	ON e.deptid = d.deptid
	GROUP BY d.deptname
	HAVING Avg(e.salary) >= 50000
```

For a user the EMPAVG will look like a table that can be accessed through -

```
SELECT * FROM EMPAVG
```

### Views and Security

Views can be used to limit the columns that someone can see for security purposes. A reason for this would be to limit what employees or staff can see about peoples pay or contact information.

As a result, you can **grant or deny read write access** to particular views.

To do this, we add the following parameter to the **create view statment**

```
WITH Read Only
```

If a user attempts to remove from a view that has the Read Only attribute, it will throw an error.